/*!
 * knockout-singlepage 0.3.1
 * (c) Michael Lowen - https://github.com/mlowen/knockout-singlepage
 * License: MIT (http://opensource.org/licenses/mit-license.php)
 */
!function(){var e=function(e){var n=function(e){var n={hash:null,query:{}},t=e.indexOf("#")+1,r=e.indexOf("?");return t>0&&(r>t?n.hash=e.slice(t,r):0>r&&(n.hash=e.slice(t))),r>=0&&e.slice(r+1).split("&").forEach(function(e){var t=e.indexOf("="),r=null,o=null;t>=0?(r=e.slice(0,t),o=e.slice(t+1)):r=e,n.query[r]&&o?Array.isArray(n.query[r])?n.query[r].push(o):n.query[r]=[n.query[r],o]:n.query[r]||(n.query[r]=o)}),n},t=function(n){var t=this,r={data:"Invalid route",name:"Route has an invalid name",url:"Route has an invalid URL"},o={whitespace:/^\s+$/,url:/^(\s+)?((\/)|((\/((:[a-z](\w+))|(\w|-)+))+))(\s+)?$/i,parameters:/:([a-z][a-z0-9]+)/gi},a=function(e){return new RegExp(("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\/?(#.*)?(\\?.*)?$").replace(o.parameters,"([a-z0-9_-]+)"),"i")};if(!n||"object"!=typeof n)throw r.data;if(!n.name||o.whitespace.test(n.name))throw r.name;if(t.name=n.name.trim(),!n.url||!o.url.test(n.url))throw r.url;t.url=n.url.trim();var u=a(t.url),i=t.url.match(o.parameters);i=i?i.map(function(e){return e.slice(1)}):[],!n.component||o.whitespace.test(n.component)?t.component=t.name:"object"==typeof n.component?(e.components.register(t.name,n.component),t.component=t.name):t.component=n.component.trim(),t.equals=function(e){return t.name==e.name||t.url==e.url||u.toString()==a(e.url).toString()},t.matches=function(e){return u.test(e)},t.parameters=function(e){var n={};return i.length&&e.match(u).slice(1).forEach(function(e,t){var r=i[t];r&&(n[r]=e)}),n},t.format=function(n){if(i.length>0&&(!n||0==n.length))return null;var r=t.url;return i.forEach(function(t){if(null!=r){var o=e.unwrap(n[t]);r=o?r.replace(":"+t,o):null}}),r}},r=function(e){var n=this,r=[],o={existingRoute:"Route clashes with existing route"};n.routes=function(){return r.map(function(e){return e.name})},n.add=function(e){if(Array.isArray(e))e.forEach(function(e){n.add(e)});else{var a=new t(e),u=r.reduce(function(e,n){return e||n.equals(a)},!1);if(u)throw o.existingRoute;r.push(a)}},n.match=function(e){var n=null,t=r.filter(function(n){return n.matches(e)})[0];return t&&(n={name:t.name,component:t.component,parameters:t.parameters(e)}),n},n.get=function(e){var n=r.filter(function(n){return n.name==e})[0];return n?n:null},e&&n.add(e)},o=function(e){var n=this,t=e,r={routeChanged:"ko-sp-route-changed",urlChanged:"ko-sp-url-changed"},o=function(e,n){Array.isArray(n)?n.forEach(function(n){o(e,n)}):t.addEventListener(e,n)},a=function(e,n){Array.isArray(n)?n.forEach(function(n){a(e,n)}):t.removeEventListener(e,n)},u=function(e,n){t.dispatchEvent(new CustomEvent(e,{detail:n}))};n.subscribe={routeChanged:function(e){o(r.routeChanged,e)},urlChanged:function(e){o(r.urlChanged,e)}},n.unsubscribe={routeChanged:function(e){a(r.routeChanged,e)},urlChanged:function(e){a(r.urlChanged,e)}},n.publish={routeChanged:function(e){u(r.routeChanged,e)},urlChanged:function(e){u(r.urlChanged,e)}}},a=function(){var n=this;n.notFoundComponent="ko-singlepage-not-found",n.component=e.observable(null),n.parameters=e.observable(null),n.hash=e.observable(null),n.query=e.observable(null),n.update=function(e){n.hash(e.context.hash),n.query(e.context.query),n.parameters(e.context.parameters),e.component?n.component(e.component):n.component(n.notFoundComponent)}},u=function(){var t=this,u=null,i=null,s=location.protocol+"//"+location.host,c=new a,l={alreadyInitialised:"Knockout-SinglePage has already been initialised",notInitialised:"Knockout-SinglePage has not been initialised",routeDoesntExist:"No route exists with name: ",parameterIsNotFunction:"Parameter is not a function"},h={route:[]},f=function(){return null!=u},d=function(){if(!f())throw l.notInitialised},m=function(e){return e?e.slice(s.length):m(location.href)},p=function(e){history.pushState(null,null,e),i.publish.urlChanged({url:e})};t.init=function(n,a){if(f())throw l.alreadyInitialised;var h=n;Array.isArray(n)&&(h={routes:n,element:a}),e.components.register(c.notFoundComponent,{template:"This page does not exist"}),h.element=h.element?h.element:document.body,h.element.dataset.bind="component: { name: component(), params: { params: parameters(), hash: hash(), query: query() } }",i=new o(h.element),u=new r(h.routes),document.body.addEventListener("click",function(e){if("a"==e.target.tagName.toLowerCase()){var n=!1;e.target.dataset.bind&&(n=e.target.dataset.bind.split(",").reduce(function(e,n){return e||"click"==n.split(":")[0].trim().toLowerCase()},!1));var r=1==(e.which||e.button),o=e.target.href.slice(0,s.length)==s;if(r&&o&&!n){var a={href:m(e.target.href)};e.target.dataset.route&&(a.route=e.target.dataset.route.toLowerCase()),"none"!=a.route&&(t.go(a,e.target),e.stopPropagation(),e.preventDefault())}}},!1),window.onpopstate=function(e){t.go(m())},h.subscribe&&(h.subscribe.routeChanged&&t.subscribe.routeChanged(h.subscribe.routeChanged),h.subscribe.urlChanged&&t.subscribe.routeChanged(h.subscribe.urlChanged)),h.hooks&&h.hooks.route&&t.hooks.route(h.hooks.route),t.go(m()),e.applyBindings(c,h.element)},t.go=function(e,t){if(d(),"string"==typeof e&&(e={href:e}),e.route&&"url-only"==e.route.toLowerCase())p(e.href);else{var r=u.match(e.href),o=n(e.href),a={url:e.href,name:r?r.name:null,element:t,component:r?r.component:null,context:{hash:o.hash,query:o.query,parameters:r?r.parameters:null}},s=!h.route.reduce(function(e,n){return e||n(a)},!1);s&&(c.update(a),i.publish.routeChanged(a),p(e.href))}},t.url=function(e,n){var t=u.get(e);if(!t)throw l.routeDoesntExist+e;return t.format(n)},t.subscribe={routeChanged:function(e){d(),i.subscribe.routeChanged(e)},urlChanged:function(e){d(),i.subscribe.urlChanged(e)}},t.unsubscribe={routeChanged:function(e){d(),i.unsubscribe.routeChanged(e)},urlChanged:function(e){d(),i.unsubscribe.urlChanged(e)}},t.hooks={route:function(e){if(Array.isArray(e))e.forEach(function(e){t.hooks.route(e)});else{if("function"!=typeof e)throw"Parameter is not function or array.";h.route.push(e)}}}},i=function(n,t){if("a"==n.tagName.toLowerCase()){var r=e.unwrap(t()),o="";o="object"==typeof r?e.singlePage.url(r.route,r.params):e.singlePage.url(r),o?n.setAttribute("href",o):n.removeAttribute("href")}};e.bindingHandlers.url={init:i,update:i},e.singlePage||(e.singlePage=new u)},n="function"==typeof define&&define.amd;if(n&&define(["knockout"],e),"undefined"!=typeof ko)e(ko);else if(!n)throw"Unable to find knockout"}();