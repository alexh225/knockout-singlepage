/*!
 * knockout-singlepage 0.3.0-alpha
 * (c) Michael Lowen - https://github.com/mlowen/knockout-singlepage
 * License: MIT (http://opensource.org/licenses/mit-license.php)
 */
!function(){var e;e=function(e){var t,r,n,o,i,s,a,u,h,l,p;if(t={hash:null,query:{}},n=e.indexOf("#")+1,u=e.indexOf("?")+1,n>0&&(1>u&&(t.hash=e.slice(n)),u>n&&(t.hash=e.slice(n,+(u-2)+1||9e9))),u>0)for(h=e.slice(u).split("&"),o=0,i=h.length;i>o;o++)a=h[o],r=a.indexOf("="),s=null,p=null,r>0?(l=a.split("="),s=l[0],p=l[1]):s=a,t.query[s]?p&&("array"==typeof t.query[s]?t.query[s].push(p):t.query[s]=[t.query[s],p]):t.query[s]=p;return t};var t;t=function(){function e(e){var t,r,n,o;if(!e.name)throw this.errors.invalidRouteName;if(!e.url)throw this.errors.invalidRouteUrl;if(t=e.name.trim(),o=("/"===e.url[0]?e.url:"/"+e.url).trim(),n="^"+o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\/?(#.*)?(\\?.*)?$",n=n.replace(this.parameterRegex,"([a-z0-9]+)"),r=e.url.match(this.parameterRegex),!t)throw this.errors.invalidRouteName;if(!o)throw this.errors.invalidRouteUrl;this.component=t,this.parameters=r?r.map(function(e){return e.slice(1)}):[],this.regex=new RegExp(n,"i")}return e.prototype.errors={invalidRouteName:"Route has no name",invalidRouteUrl:"Route has an invalid URL"},e.prototype.parameterRegex=/:([a-z][a-z0-9]+)/gi,e.prototype.clashesWith=function(e){return e.component===this.component||e.regex.toString()===this.regex.toString()},e.prototype.matches=function(e){return this.regex.test(e)},e.prototype.extractParameters=function(e){var t,r,n,o,i;if(o={},this.parameters.length)for(n=e.match(this.regex).slice(1),r=t=0,i=this.parameters.length-1;i>=0?i>=t:t>=i;r=i>=0?++t:--t)o[this.parameters[r]]=n[r];return o},e}();var r;r=function(){function e(e,t){this.ko=e,this.routes=[],t&&this.add(t)}return e.prototype.errors={invalidRoute:"Invalid route",duplicateRoute:"Route clashes with existing route"},e.prototype.add=function(e){var r,n,o,i;if(Array.isArray(e)){for(i=[],r=0,n=e.length;n>r;r++)o=e[r],i.push(this.add(o));return i}if(!e)throw this.errors.invalidRoute;if(o=new t(e),this.routes.filter(function(e){return o.clashesWith(e)}).length)throw this.errors.duplicateRoute;return e.component&&this.ko.components.register(o.component,e.component),this.routes.push(o)},e.prototype.get=function(e){var t,r;return t=this.routes.filter(function(t){return t.matches(e)})[0],r=null,t&&(r={component:t.component,parameters:t.extractParameters(e)}),r},e}();var n;n=function(t){var n;return n=function(){function n(){this.router=null,this.baseUrl=location.protocol+"//"+location.host,this.notFoundComponent="ko-singlepage-notfound",this.viewModel={component:t.observable(null),parameters:t.observable(null),hash:t.observable(null),query:t.observable(null)},this.events={routeChanged:"ko-sp-route-changed"}}return n.prototype.init=function(e,n){var o;if(this.router)throw"Router has already been initialised";return o=e,Array.isArray(e)&&(o={routes:e,element:n}),t.components.register(this.notFoundComponent,{template:"This page does not exist"}),this.router=new r(t,o.routes),this.element=null!=o.element?o.element:document.body,this.element.dataset.bind="component: { name: component(), params: { params: parameters(), hash: hash(), query: query() } }",document.body.addEventListener("click",function(e){return function(t){var r,n,o,i;return"a"===t.target.tagName.toLowerCase()&&(t.target.dataset.bind&&(r=t.target.dataset.bind.split(",").reduce(function(e,t){return"click"===t.split(":")[0].trim().toLowerCase()||e},!1)),o=1===(t.which||evt.button),n=t.target.href.slice(0,e.baseUrl.length)===e.baseUrl,o&&n&&!r&&(i={href:t.target.href.slice(e.baseUrl.length)},null!=t.target.dataset.route&&(i.route=t.target.dataset.route.toLowerCase()),"none"!==i.route))?(e.go(i),t.stopPropagation(),t.preventDefault()):void 0}}(this),!1),window.onpopstate=function(e){return function(t){return e.go(location.href.slice(e.baseUrl.length))}}(this),null!=o.on&&null!=o.on.routeChanged&&this.onRouteChanged(o.on.routeChanged),this.go(location.href.slice(this.baseUrl.length)),t.applyBindings(this.viewModel,this.element)},n.prototype.go=function(t){var r,n;if(!this.router)throw"Router has not been initialised";return"object"!=typeof t&&(t={href:t}),"url-only"!==t.route&&(n=this.router.get(t.href),n?(r=e(t.href),this.viewModel.hash(r.hash),this.viewModel.query(r.query),this.viewModel.parameters(n.parameters),this.viewModel.component(n.component)):(this.viewModel.hash(null),this.viewModel.query(null),this.viewModel.parameters(null),this.viewModel.component(this.notFoundComponent)),this.element.dispatchEvent(new CustomEvent(this.events.routeChanged,{detail:{url:t.href,component:this.viewModel.component(),context:{hash:this.viewModel.hash(),query:this.viewModel.query(),parameters:this.viewModel.parameters()}}}))),history.pushState(null,null,t.href)},n.prototype.on=function(e,t){return this.element.addEventListener(e,t)},n.prototype.onRouteChanged=function(e){return this.on(this.events.routeChanged,e)},n.prototype.off=function(e,t){return this.element.removeEventListener(e,t)},n.prototype.offRouteChanged=function(e){return this.off(this.events.routeChanged,e)},n}(),t.singlePage?void 0:t.singlePage=new n};var o="function"==typeof define&&define.amd;if(o&&define(["knockout"],n),"undefined"!=typeof ko)n(ko);else if(!o)throw"Unable to find knockout"}();