/*!
 * knockout-singlepage 0.3.0-alpha
 * (c) Michael Lowen - https://github.com/mlowen/knockout-singlepage
 * License: MIT (http://opensource.org/licenses/mit-license.php)
 */
!function(){var e=function(e){var n=function(e){var n={hash:null,query:{}},t=e.indexOf("#")+1,r=e.indexOf("?");return t>0&&(r>t?n.hash=e.slice(t,r):0>r&&(n.hash=e.slice(t))),r>=0&&e.slice(r+1).split("&").forEach(function(e){var t=e.indexOf("="),r=null,a=null;t>=0?(r=e.slice(0,t),a=e.slice(t+1)):r=e,n.query[r]&&a?Array.isArray(n.query[r])?n.query[r].push(a):n.query[r]=[n.query[r],a]:n.query[r]||(n.query[r]=a)}),n},t=function(n){var t=this,r={data:"Invalid route",name:"Route has an invalid name",url:"Route has an invalid URL",noParameters:"No parameters supplied to format route",missingParameter:"Unable to format route due to missing parameter: "},a={whitespace:/^\s+$/,url:/^(\s+)?((\/)|((\/((:[a-z](\w+))|(\w|-)+))+))(\s+)?$/i,parameters:/:([a-z][a-z0-9]+)/gi},o=function(e){return new RegExp(("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\/?(#.*)?(\\?.*)?$").replace(a.parameters,"([a-z0-9]+)"),"i")};if(!n||"object"!=typeof n)throw r.data;if(!n.name||a.whitespace.test(n.name))throw r.name;if(t.name=n.name.trim(),!n.url||!a.url.test(n.url))throw r.url;t.url=n.url.trim();var u=o(t.url),i=t.url.match(a.parameters);i=i?i.map(function(e){return e.slice(1)}):[],!n.component||a.whitespace.test(n.component)?t.component=t.name:"object"==typeof n.component?(e.components.register(t.name,n.component),t.component=t.name):t.component=n.component.trim(),t.equals=function(e){return t.name==e.name||t.url==e.url||u.toString()==o(e.url).toString()},t.matches=function(e){return u.test(e)},t.parameters=function(e){var n={};return i.length&&e.match(u).slice(1).forEach(function(e,t){var r=i[t];r&&(n[r]=e)}),n},t.format=function(n){if(i.length>0&&(!n||0==n.length))throw r.noParameters;var a=t.url;return i.forEach(function(t){var o=e.unwrap(n[t]);if(!o)throw r.missingParameter+t;a=a.replace(":"+t,o)}),a}},r=function(e){var n=this,r=[],a={existingRoute:"Route clashes with existing route"};n.routes=function(){return r.map(function(e){return e.name})},n.add=function(e){if(Array.isArray(e))e.forEach(function(e){n.add(e)});else{var o=new t(e),u=r.reduce(function(e,n){return e||n.equals(o)},!1);if(u)throw a.existingRoute;r.push(o)}},n.match=function(e){var n=null,t=r.filter(function(n){return n.matches(e)})[0];return t&&(n={name:t.name,component:t.component,parameters:t.parameters(e)}),n},e&&n.add(e)},a=function(e){var n=this,t=e,r={routeChanged:"ko-sp-route-changed",urlChanged:"ko-sp-url-changed"},a=function(e,n){Array.isArray(n)?n.forEach(function(n){a(e,n)}):t.addEventListener(e,n)},o=function(e,n){Array.isArray(n)?n.forEach(function(n){o(e,n)}):t.removeEventListener(e,n)},u=function(e,n){t.dispatchEvent(new CustomEvent(e,{detail:n}))};n.subscribe={routeChanged:function(e){a(r.routeChanged,e)},urlChanged:function(e){a(r.urlChanged,e)}},n.unsubscribe={routeChanged:function(e){o(r.routeChanged,e)},urlChanged:function(e){o(r.urlChanged,e)}},n.publish={routeChanged:function(e){u(r.routeChanged,e)},urlChanged:function(e){u(r.urlChanged,e)}}},o=function(){var n=this;n.notFoundComponent="ko-singlepage-not-found",n.component=e.observable(null),n.parameters=e.observable(null),n.hash=e.observable(null),n.query=e.observable(null),n.update=function(e,t){e?(n.hash(t.hash),n.query(t.query),n.parameters(e.parameters),n.component(e.component)):(n.component(n.notFoundComponent),n.parameters(null),n.hash(null),n.query(null))}},u=function(){var t=this,u=null,i=null,s=location.protocol+"//"+location.host,l=new o,c={alreadyInitialised:"Knockout-SinglePage has already been initialised",notInitialised:"Knockout-SinglePage has not been initialised"},h=function(){return null!=u},f=function(){if(!h())throw c.notInitialised},d=function(e){return e?e.slice(s.length):d(location.href)};t.init=function(n,o){if(h())throw c.alreadyInitialised;var f=n;Array.isArray(n)&&(f={routes:n,element:o}),e.components.register(l.notFoundComponent,{template:"This page does not exist"}),f.element=f.element?f.element:document.body,f.element.dataset.bind="component: { name: component(), params: { params: parameters(), hash: hash(), query: query() } }",i=new a(f.element),u=new r(f.routes),document.body.addEventListener("click",function(e){if("a"==e.target.tagName.toLowerCase()){var n=!1;e.target.dataset.bind&&(n=e.target.dataset.bind.split(",").reduce(function(e,n){return e||"click"==n.split(":")[0].trim().toLowerCase()},!1));var r=1==(e.which||e.button),a=e.target.href.slice(0,s.length)==s;if(r&&a&&!n){var o={href:d(e.target.href)};e.target.dataset.route&&(o.route=e.target.dataset.route.toLowerCase()),"none"!=o.route&&(t.go(o),e.stopPropagation(),e.preventDefault())}}},!1),window.onpopstate=function(e){t.go(d())},f.subscribe&&(f.subscribe.routeChanged&&t.subscribe.routeChanged(f.subscribe.routeChanged),f.subscribe.urlChanged&&t.subscribe.routeChanged(f.subscribe.urlChanged)),t.go(d()),e.applyBindings(l,f.element)},t.go=function(e){if(f(),"string"==typeof e&&(e={href:e}),!e.route||"url-only"!=e.route.toLowerCase()){var t=u.match(e.href);t?l.update(t,n(e.href)):l.update(),i.publish.routeChanged({url:e.href,name:t?t.name:null,component:t?t.component:null,context:{hash:l.hash(),query:l.query(),parameters:l.parameters()}})}history.pushState(null,null,e.href),i.publish.urlChanged({url:e.href})},t.subscribe={routeChanged:function(e){f(),i.subscribe.routeChanged(e)},urlChanged:function(e){f(),i.subscribe.urlChanged(e)}},t.unsubscribe={routeChanged:function(e){f(),i.unsubscribe.routeChanged(e)},urlChanged:function(e){f(),i.unsubscribe.urlChanged(e)}}};e.singlePage||(e.singlePage=new u)},n="function"==typeof define&&define.amd;if(n&&define(["knockout"],e),"undefined"!=typeof ko)e(ko);else if(!n)throw"Unable to find knockout"}();